# JVLink MCP Server

**Claudeに話しかけるだけで、競馬データを自由に分析できます。**

SQLを書く必要はありません。自然な日本語で質問すれば、過去のレース結果、騎手成績、血統傾向など、あらゆる競馬データを調べられます。

<img src="docs/images/demo.gif" width="800" alt="デモ動画">

## こんな質問ができます

### 「1番人気の勝率はどのくらい？」

| 出走数 | 勝利数 | 勝率 |
|--------|--------|------|
| 6,294 | 2,474 | 39.3% |

### 「今年勝ち星が多い騎手は？」

| 騎手 | 騎乗数 | 勝利 | 勝率 |
|------|--------|------|------|
| ルメール | 537 | 142 | 26.4% |
| 戸崎圭太 | 832 | 135 | 16.2% |
| 松山弘平 | 863 | 125 | 14.5% |
| 坂井瑠星 | 729 | 119 | 16.3% |
| 川田将雅 | 542 | 118 | 21.8% |

### 「産駒の勝ち星が多い種牡馬は？」

| 種牡馬 | 出走数 | 勝利 |
|--------|--------|------|
| キズナ | 1,717 | 207 |
| ロードカナロア | 1,633 | 178 |
| ドレフォン | 1,382 | 150 |
| エピファネイア | 1,488 | 138 |
| リアルスティール | 1,106 | 125 |

### 他にもこんな質問ができます

- 東京芝1600mで内枠と外枠、どっちが有利？
- G1レースで1番人気が飛んだレースを教えて
- ディープインパクト産駒の芝での成績は？
- 馬体重500kg以上の馬の成績は？
- 上がり3F最速で勝った馬を調べて

## 構成パターン

JV-Linkデータの取得にはWindowsが必要ですが、利用環境に応じて以下の構成が可能です。

```
┌─────────────────────────────────────────────────────────────────┐
│ パターン A: Windows完結（推奨）                                   │
│                                                                 │
│   Windows PC                                                    │
│   ┌─────────────┐    ┌─────────────┐    ┌─────────────┐        │
│   │  jrvltsql   │───▶│  keiba.db   │◀───│ MCPサーバー  │        │
│   │ (データ取得) │    │  (SQLite)   │    │             │        │
│   └─────────────┘    └─────────────┘    └──────┬──────┘        │
│                                                 │               │
│                                        ┌───────▼───────┐       │
│                                        │ Claude Desktop │       │
│                                        └───────────────┘       │
└─────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────┐
│ パターン B: DBファイルをコピー                                    │
│                                                                 │
│   Windows PC                           Mac / Linux              │
│   ┌─────────────┐    ┌─────────────┐    ┌─────────────┐        │
│   │  jrvltsql   │───▶│  keiba.db   │─┬─▶│  keiba.db   │        │
│   │ (データ取得) │    │  (SQLite)   │ │  │  (コピー)   │        │
│   └─────────────┘    └─────────────┘ │  └──────┬──────┘        │
│                                      │         │               │
│                        ファイル共有/  │  ┌──────▼──────┐        │
│                        クラウド同期   │  │ MCPサーバー  │        │
│                                      │  └──────┬──────┘        │
│                                      │         │               │
│                                      │  ┌──────▼──────┐        │
│                                      │  │Claude Desktop│        │
│                                      │  └─────────────┘        │
└─────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────┐
│ パターン C: PostgreSQL経由                                       │
│                                                                 │
│   Windows PC                           Mac / Linux              │
│   ┌─────────────┐    ┌─────────────┐    ┌─────────────┐        │
│   │  jrvltsql   │───▶│ PostgreSQL  │◀───│ MCPサーバー  │        │
│   │ (データ取得) │    │  サーバー   │    │             │        │
│   └─────────────┘    └─────────────┘    └──────┬──────┘        │
│                            ▲                   │               │
│                            │ネットワーク        │               │
│                            │                   │               │
│                                         ┌──────▼──────┐        │
│                                         │Claude Desktop│        │
│                                         └─────────────┘        │
└─────────────────────────────────────────────────────────────────┘
```

| パターン | メリット | デメリット |
|---------|---------|-----------|
| **A: Windows完結** | セットアップが簡単、.mcpbで一発インストール | WindowsでClaude Desktopを使う必要がある |
| **B: DBファイルコピー** | Mac/LinuxでClaude Desktopを使える | DBの更新のたびにコピーが必要 |
| **C: PostgreSQL経由** | リアルタイムでデータ更新を反映 | PostgreSQLサーバーの構築・運用が必要 |

## インストール

### 必要なもの

- **Python 3.11以上**
- **競馬データベース** - [jrvltsql](https://github.com/miyamamoto/jrvltsql) で作成

### 方法1: .mcpbで簡単インストール（パターンA: Windows完結）

Windowsで全てを完結させる最もシンプルな方法です。

1. [Releases](https://github.com/miyamamoto/jvlink-mcp-server/releases)から `.mcpb` ファイルをダウンロード
2. ダウンロードした `.mcpb` ファイルをダブルクリック
3. Claude Desktopのインストール画面でデータベースファイル（keiba.db）のパスを指定
4. インストール完了

> **💡 初回起動について**
>
> 初回起動時に依存パッケージを自動インストールします（30〜60秒）。
> インターネット接続が必要です。2回目以降は即座に起動します。

### 方法2: 手動インストール（パターンB/C、またはWindows以外）

Mac/LinuxでClaude Desktopを使う場合や、リモートDBに接続する場合はこちら。

<details>
<summary>クリックして展開</summary>

#### 1. リポジトリをクローン

```bash
git clone https://github.com/miyamamoto/jvlink-mcp-server.git
cd jvlink-mcp-server
```

#### 2. 依存関係をインストール

```bash
pip install uv
uv sync
```

#### 3. Claude Desktopに接続

`claude_desktop_config.json` に追加:

**パターンA/B（SQLite）の場合:**

```json
{
  "mcpServers": {
    "jvlink": {
      "command": "uv",
      "args": [
        "run",
        "--directory",
        "/path/to/jvlink-mcp-server",
        "python",
        "-m",
        "jvlink_mcp_server.server"
      ],
      "env": {
        "DB_TYPE": "sqlite",
        "DB_PATH": "/path/to/keiba.db"
      }
    }
  }
}
```

**パターンC（PostgreSQL）の場合:**

```json
{
  "mcpServers": {
    "jvlink": {
      "command": "uv",
      "args": [
        "run",
        "--directory",
        "/path/to/jvlink-mcp-server",
        "python",
        "-m",
        "jvlink_mcp_server.server"
      ],
      "env": {
        "DB_TYPE": "postgresql",
        "DB_HOST": "your-windows-pc.local",
        "DB_PORT": "5432",
        "DB_NAME": "keiba",
        "DB_USER": "your_user",
        "DB_PASSWORD": "your_password"
      }
    }
  }
}
```

パスは環境に合わせて変更してください。Claude Desktopを再起動すれば使えます。

#### Claude Codeで使う場合

```bash
claude mcp add jvlink \
  -e DB_TYPE=sqlite \
  -e DB_PATH=/path/to/keiba.db \
  -- uv run --directory /path/to/jvlink-mcp-server python -m jvlink_mcp_server.server
```

</details>

## 使い方のコツ

### 1. まずは気軽に質問
思いついたことをそのまま聞いてみてください。Claudeが適切なデータを探して回答します。

### 2. 具体的な条件を追加
「東京の」「芝の」「1600mの」「G1の」など、条件を追加するとより詳細な分析ができます。

### 3. 比較を依頼
「AとBを比較して」「年度別に推移を見せて」など、比較分析も得意です。

### 4. 深掘りする
回答を見て気になったことがあれば、続けて質問してください。会話の流れで分析を深められます。

## もっと詳しく

### 質問例をもっと見たい
→ [サンプル質問集](docs/SAMPLE_QUESTIONS.md)

初級から上級まで、200以上の質問例があります。

### 技術的な詳細を知りたい
→ [データベース構成](docs/DATABASE_SETUP.md) / [クエリガイドライン](QUERY_GUIDELINES.md)

開発者向けの技術情報です。

## JRA-VANデータの利用について

本ソフトウェアで分析するデータは[JRA-VAN](https://jra-van.jp/)から提供されるものであり、利用にあたっては**JRA-VAN利用規約**に従う必要があります。

### 禁止事項

- データの再配布
- データの複製・編集・配信
- 第三者へのデータ提供
- データベースファイル（keiba.db等）の共有

### 許可される利用

- 個人的な競馬分析・研究
- 自社内での利用

詳細は [JRA-VAN利用規約](https://jra-van.jp/info/rule.html) をご確認ください。

## ライセンス

Apache License 2.0
